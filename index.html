<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laureata a Catena - Edizione Completa</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #1a2a6c;
            --secondary: #b21f1f;
            --accent: #fdbb2d;
            --success: #2ecc71;
            --danger: #e74c3c;
            --info: #3498db;
            --dark: #0d1426;
            --light: #f8f9fa;
            --transition: all 0.3s ease;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            --glow: 0 0 20px rgba(253, 187, 45, 0.6);
        }

        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            overflow-y: auto;
        }

        .hidden {
            display: none !important;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--accent);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--accent);
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
        }

        h2 {
            font-size: 1.4rem;
            color: var(--light);
        }

        /* SETUP SCREEN */
        .setup-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
        }

        .teams-container {
            display: flex;
            gap: 30px;
            width: 100%;
            max-width: 900px;
        }

        .team-box {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 20px;
            border: 3px solid var(--accent);
            box-shadow: var(--shadow);
        }

        .team-box h3 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent);
            font-size: 1.5rem;
        }

        .player-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--info), #2980b9);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #f39c12);
            color: var(--dark);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: white;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .player-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        /* ONLINE SCREEN */
        .online-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .connection-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--accent);
            text-align: center;
        }

        .connection-code {
            font-size: 3rem;
            font-weight: bold;
            color: var(--accent);
            margin: 15px 0;
            text-shadow: 0 0 15px rgba(253, 187, 45, 0.7);
        }

        .qr-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            display: inline-block;
            margin: 15px 0;
        }

        .devices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .device-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--accent);
            text-align: center;
            transition: var(--transition);
        }

        .device-card.connected {
            border-color: var(--success);
            background: rgba(46, 204, 113, 0.2);
        }

        .device-card.answering {
            border-color: var(--info);
            background: rgba(52, 152, 219, 0.3);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* MOBILE SCREEN */
        .mobile-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
            text-align: center;
        }

        .connection-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 400px;
        }

        .player-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 400px;
        }

        .player-option {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .player-option:hover, .player-option.selected {
            background: rgba(52, 152, 219, 0.3);
            border-color: var(--info);
        }

        .buzzer-container {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
        }

        .buzzer-btn {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--danger), #c0392b);
            border: none;
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .buzzer-btn:active {
            transform: translateX(-50%) scale(0.95);
        }

        .buzzer-btn:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
        }

        /* GAME SCREENS */
        .game-container {
            flex: 1;
            display: flex;
            gap: 20px;
            height: calc(100% - 100px);
        }

        .team-panel {
            width: 200px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid var(--accent);
            display: flex;
            flex-direction: column;
        }

        .team-panel.active {
            border-color: var(--success);
            background: rgba(46, 204, 113, 0.2);
            box-shadow: var(--glow);
        }

        .team-score {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            color: var(--accent);
        }

        .team-panel.active .team-score {
            color: var(--success);
        }

        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        /* GIOCO 1: CACCIA ALLA PAROLA */
        .word-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .letter-box {
            width: 60px;
            height: 60px;
            border: 3px solid var(--accent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .letter-box.revealed {
            background: linear-gradient(135deg, var(--accent), #f39c12);
            transform: scale(1.1);
            box-shadow: var(--glow);
        }

        /* GIOCO 2: QUANDO, DOVE, COME, PERCH√â */
        .quartina-container {
            width: 100%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--accent);
        }

        .quartina-line {
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 4px solid transparent;
            transition: var(--transition);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quartina-line.revealed {
            background: rgba(253, 187, 45, 0.2);
            border-left-color: var(--accent);
        }

        .points-display {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--accent);
            text-align: center;
            margin: 15px 0;
        }

        /* GIOCO 3: UNA TIRA L'ALTRA */
        .chain-container {
            width: 100%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--accent);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chain-word {
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            border-left: 4px solid transparent;
            transition: var(--transition);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chain-word.revealed {
            background: rgba(253, 187, 45, 0.2);
            border-left-color: var(--accent);
        }

        .chain-word.hidden {
            background: rgba(178, 31, 31, 0.3);
            border-left-color: var(--secondary);
            color: transparent;
        }

        .chain-word.current {
            box-shadow: var(--glow);
            transform: scale(1.05);
        }

        .zip-container {
            width: 100%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--success);
        }

        /* CONTROLLI COMUNI */
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .message-box {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px;
        }

        .answer-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .player-answer-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--info), #2980b9);
            color: white;
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
            animation: pulse 1s infinite;
        }

        .round-info {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent);
            text-align: center;
            margin: 10px 0;
        }

        .timer {
            font-size: 1.3rem;
            font-weight: bold;
            padding: 10px 20px;
            background: rgba(231, 76, 60, 0.3);
            border-radius: 10px;
            border: 2px solid var(--danger);
            color: var(--accent);
        }

        .direction-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .direction-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .direction-btn.active {
            background: linear-gradient(135deg, var(--danger), #c0392b);
        }

        @media (max-width: 768px) {
            .teams-container, .game-container {
                flex-direction: column;
            }
            
            .team-panel {
                width: 100%;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .connection-code {
                font-size: 2rem;
            }
            
            .letter-box {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- SCHERMATA PRINCIPALE -->
    <div class="screen" id="setupScreen">
        <header>
            <h1>üéì LAUREATA A CATENA</h1>
            <h2>Pi√π difficile della tesi (ma pi√π divertente)</h2>
        </header>
        
        <div class="setup-container">
            <div class="teams-container">
                <div class="team-box">
                    <h3>üë• SQUADRA A</h3>
                    <div class="player-input">
                        <input type="text" id="teamAPlayerInput" placeholder="Nome giocatore">
                        <button class="btn btn-primary btn-small" id="addTeamAPlayer">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="player-list" id="teamAPlayerList"></div>
                </div>
                
                <div class="team-box">
                    <h3>üë• SQUADRA B</h3>
                    <div class="player-input">
                        <input type="text" id="teamBPlayerInput" placeholder="Nome giocatore">
                        <button class="btn btn-primary btn-small" id="addTeamBPlayer">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="player-list" id="teamBPlayerList"></div>
                </div>
            </div>
            
            <button class="btn btn-accent" id="onlineModeBtn">
                <i class="fas fa-wifi"></i> MODALIT√Ä ONLINE
            </button>
        </div>
    </div>

    <!-- SCHERMATA ONLINE HOST -->
    <div class="screen hidden" id="onlineScreen">
        <header>
            <h1>üåê MODALIT√Ä ONLINE - HOST</h1>
            <h2>Configura la partita e gestisci i giocatori</h2>
        </header>
        
        <div class="online-container">
            <div class="connection-box">
                <h3>üì≤ CODICE DI CONNESSIONE</h3>
                <div class="connection-code" id="connectionCode">ABCD</div>
                <p>Condividi questo codice con i giocatori</p>
                
                <div class="qr-box">
                    <div style="font-size: 3rem; font-weight: bold; color: #333; padding: 20px;">
                        <div id="qrCodeText">ABCD</div>
                    </div>
                    <p style="color: #333;">Scansiona o condividi il codice</p>
                </div>
                
                <div class="devices-grid" id="devicesGrid">
                    <p>Nessun dispositivo connesso...</p>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn btn-primary" id="startOnlineGameBtn" disabled>
                    <i class="fas fa-play-circle"></i> INIZIA PARTITA
                </button>
                <button class="btn btn-secondary" id="backToSetupBtn">
                    <i class="fas fa-arrow-left"></i> INDIETRO
                </button>
            </div>
        </div>
        
        <div class="player-answer-display hidden" id="playerAnswerDisplay">
            <!-- Qui appare chi preme il buzzer -->
        </div>
    </div>

    <!-- SCHERMATA MOBILE GIOCATORI -->
    <div class="screen hidden" id="mobileScreen">
        <div class="mobile-container">
            <header>
                <h1>üì± LAUREATA A CATENA</h1>
                <p>Connettiti e gioca con il tuo team!</p>
            </header>
            
            <div class="connection-form" id="connectionForm">
                <h3>üîó CONNESSIONE</h3>
                <input type="text" id="connectionCodeInput" placeholder="Inserisci codice partita" value="ABCD">
                <button class="btn btn-primary" id="connectToGameBtn">
                    <i class="fas fa-plug"></i> CONNETTI
                </button>
            </div>
            
            <div class="player-options hidden" id="playerOptions">
                <h3>üë§ SELEZIONA IL TUO NOME</h3>
                <!-- Opzioni giocatori dinamiche -->
            </div>
            
            <div class="waiting-screen hidden" id="waitingScreen">
                <div class="message-box">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px;"></i>
                    <h3>In attesa che l'host inizi la partita...</h3>
                    <p id="playerInfoDisplay"></p>
                </div>
            </div>
        </div>
        
        <div class="buzzer-container">
            <button class="buzzer-btn hidden" id="buzzerBtn">
                <i class="fas fa-bolt"></i>
                BUZZER
            </button>
        </div>
    </div>

    <!-- GIOCO 1: CACCIA ALLA PAROLA -->
    <div class="screen hidden" id="game1Screen">
        <header>
            <h1>üîç CACCIA ALLA PAROLA</h1>
            <div class="round-info" id="game1RoundInfo">Parola 1/8</div>
        </header>
        
        <div class="game-container">
            <div class="team-panel" id="teamAPanel1">
                <h3 id="teamAName1">SQUADRA A</h3>
                <div class="team-score" id="teamAScore1">‚Ç¨0</div>
                <div class="player-list" id="teamAPlayers1"></div>
            </div>
            
            <div class="game-area">
                <div class="word-grid" id="wordGrid"></div>
                
                <div class="message-box" id="game1Message">
                    Pronto a iniziare? Clicca "INIZIA"!
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="startGame1Btn">
                        <i class="fas fa-play"></i> INIZIA
                    </button>
                    <button class="btn btn-danger" id="buzzerGame1Btn" disabled>
                        <i class="fas fa-bolt"></i> BUZZER
                    </button>
                    <button class="btn btn-secondary" id="nextWordBtn" disabled>
                        <i class="fas fa-forward"></i> PROSSIMA
                    </button>
                </div>
                
                <div class="answer-controls hidden" id="answerControls1">
                    <button class="btn btn-primary" id="correctAnswer1Btn">
                        <i class="fas fa-check"></i> ESATTA
                    </button>
                    <button class="btn btn-danger" id="wrongAnswer1Btn">
                        <i class="fas fa-times"></i> ERRATA
                    </button>
                </div>
            </div>
            
            <div class="team-panel" id="teamBPanel1">
                <h3 id="teamBName1">SQUADRA B</h3>
                <div class="team-score" id="teamBScore1">‚Ç¨0</div>
                <div class="player-list" id="teamBPlayers1"></div>
            </div>
        </div>
    </div>

    <!-- GIOCO 2: QUANDO, DOVE, COME, PERCH√â -->
    <div class="screen hidden" id="game2Screen">
        <header>
            <h1>‚ùì QUANDO, DOVE, COME, PERCH√â</h1>
            <div class="round-info" id="game2RoundInfo">Quartina 1/4</div>
        </header>
        
        <div class="game-container">
            <div class="team-panel" id="teamAPanel2">
                <h3 id="teamAName2">SQUADRA A</h3>
                <div class="team-score" id="teamAScore2">‚Ç¨0</div>
                <div class="player-list" id="teamAPlayers2"></div>
            </div>
            
            <div class="game-area">
                <div class="quartina-container">
                    <div class="quartina-line" id="quandoLine">
                        <i class="fas fa-clock"></i> <span id="quandoText">(Quando...)</span>
                    </div>
                    <div class="quartina-line" id="doveLine">
                        <i class="fas fa-map-marker-alt"></i> <span id="doveText">(Dove...)</span>
                    </div>
                    <div class="quartina-line" id="comeLine">
                        <i class="fas fa-theater-masks"></i> <span id="comeText">(Come...)</span>
                    </div>
                    <div class="quartina-line" id="percheLine">
                        <i class="fas fa-question"></i> <span id="percheText">(Perch√©...)</span>
                    </div>
                </div>

                <div class="points-display" id="quartinaPoints">
                    üèÜ Premio: <span id="pointsValue">‚Ç¨8.000</span>
                </div>
                
                <div class="message-box" id="game2Message">
                    Premi "INIZIA QUARTINA" per cominciare!
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="startGame2Btn">
                        <i class="fas fa-play"></i> INIZIA QUARTINA
                    </button>
                    <button class="btn btn-secondary" id="nextClueBtn" disabled>
                        <i class="fas fa-forward"></i> PROSSIMO INDIZIO
                    </button>
                    <button class="btn btn-warning" id="nextQuartinaBtn" disabled>
                        <i class="fas fa-clipboard-list"></i> PROSSIMA QUARTINA
                    </button>
                </div>
                
                <div class="answer-controls hidden" id="answerControls2">
                    <button class="btn btn-primary" id="correctAnswer2Btn">
                        <i class="fas fa-check"></i> ESATTA
                    </button>
                    <button class="btn btn-danger" id="wrongAnswer2Btn">
                        <i class="fas fa-times"></i> ERRATA
                    </button>
                </div>
            </div>
            
            <div class="team-panel" id="teamBPanel2">
                <h3 id="teamBName2">SQUADRA B</h3>
                <div class="team-score" id="teamBScore2">‚Ç¨0</div>
                <div class="player-list" id="teamBPlayers2"></div>
            </div>
        </div>
    </div>

    <!-- GIOCO 3: UNA TIRA L'ALTRA -->
    <div class="screen hidden" id="game3Screen">
        <header>
            <h1>‚õìÔ∏è UNA TIRA L'ALTRA</h1>
            <div class="round-info" id="game3RoundInfo">Catena 1/2</div>
        </header>
        
        <div class="game-container">
            <div class="team-panel" id="teamAPanel3">
                <h3 id="teamAName3">SQUADRA A</h3>
                <div class="team-score" id="teamAScore3">‚Ç¨0</div>
                <div class="player-list" id="teamAPlayers3"></div>
            </div>
            
            <div class="game-area">
                <div class="chain-container" id="chainContainer"></div>
                
                <div class="timer hidden" id="chainTimer">
                    ‚è∞ Tempo: <span id="timerValue">20</span>s
                </div>
                
                <div class="message-box" id="game3Message">
                    Scegli la direzione e inizia la catena!
                </div>

                <div class="direction-controls" id="directionControls">
                    <button class="direction-btn" id="topDirectionBtn">
                        <i class="fas fa-arrow-up"></i> Dall'alto
                    </button>
                    <button class="direction-btn" id="bottomDirectionBtn">
                        <i class="fas fa-arrow-down"></i> Dal basso
                    </button>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="startGame3Btn" disabled>
                        <i class="fas fa-play"></i> INIZIA CATENA
                    </button>
                    <button class="btn btn-danger" id="buzzerGame3Btn" disabled>
                        <i class="fas fa-bolt"></i> BUZZER
                    </button>
                    <button class="btn btn-secondary" id="nextChainBtn" disabled>
                        <i class="fas fa-forward"></i> PROSSIMA CATENA
                    </button>
                </div>

                <div class="direction-controls hidden" id="directionOptions">
                    <button class="direction-btn" id="continueDirectionBtn">
                        <i class="fas fa-redo"></i> Continua
                    </button>
                    <button class="direction-btn" id="changeDirectionBtn">
                        <i class="fas fa-exchange-alt"></i> Cambia
                    </button>
                </div>
                
                <div class="answer-controls hidden" id="answerControls3">
                    <button class="btn btn-primary" id="correctAnswer3Btn">
                        <i class="fas fa-check"></i> ESATTA
                    </button>
                    <button class="btn btn-danger" id="wrongAnswer3Btn">
                        <i class="fas fa-times"></i> ERRATA
                    </button>
                </div>

                <!-- ZIP GAME -->
                <div class="zip-container hidden" id="zipContainer">
                    <h3 style="text-align: center; margin-bottom: 15px;">üéØ GIOCO DELLA ZIP</h3>
                    <div class="chain-container">
                        <div class="chain-word revealed" id="zipWord1">CAPO</div>
                        <div class="chain-word hidden" id="zipWord2">?</div>
                        <div class="chain-word hidden" id="zipWord3">?</div>
                        <div class="chain-word revealed" id="zipWord4">OPERATIVA</div>
                    </div>
                    <div class="points-display" id="zipPrize">
                        üèÜ Premio ZIP: <span id="prizeValue">‚Ç¨15.000</span>
                    </div>
                    <div class="message-box" id="zipMessage">
                        Vuoi giocare la ZIP o passare la mano?
                    </div>
                    <div class="controls">
                        <button class="btn btn-warning" id="playZipBtn">
                            <i class="fas fa-gamepad"></i> GIOCA ZIP
                        </button>
                        <button class="btn btn-secondary" id="passZipBtn">
                            <i class="fas fa-redo"></i> PASSA MANO
                        </button>
                    </div>
                    <div class="answer-controls hidden" id="zipAnswerControls">
                        <button class="btn btn-primary" id="zipCorrectBtn">
                            <i class="fas fa-check"></i> ESATTA
                        </button>
                        <button class="btn btn-danger" id="zipWrongBtn">
                            <i class="fas fa-times"></i> ERRATA
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="team-panel" id="teamBPanel3">
                <h3 id="teamBName3">SQUADRA B</h3>
                <div class="team-score" id="teamBScore3">‚Ç¨0</div>
                <div class="player-list" id="teamBPlayers3"></div>
            </div>
        </div>
    </div>

    <script>
        // üéÆ SISTEMA COMPLETO DEL GIOCO
        class LaureataACatena {
            constructor() {
                this.initializeGame();
                this.setupEventListeners();
            }
            
            initializeGame() {
                // Stato del gioco
                this.gameState = {
                    // Squadre
                    teamA: { name: 'SQUADRA A', players: [], score: 0 },
                    teamB: { name: 'SQUADRA B', players: [], score: 0 },
                    currentTeam: 'A',
                    
                    // Online
                    onlineMode: false,
                    connectionCode: this.generateCode(),
                    connectedDevices: new Map(),
                    
                    // Giochi
                    currentGame: 1,
                    game1: { 
                        currentRound: 1, 
                        totalRounds: 8,
                        currentWord: '',
                        revealedLetters: [],
                        gameStarted: false
                    },
                    game2: { 
                        currentRound: 1, 
                        totalRounds: 4,
                        currentStep: 0,
                        points: 8000,
                        gameStarted: false
                    },
                    game3: { 
                        currentRound: 1, 
                        totalRounds: 2,
                        currentDirection: '',
                        currentWordIndex: 0,
                        gameStarted: false,
                        timer: null,
                        timeLeft: 20
                    }
                };
                
                // Dati dei giochi
                this.words = [
                    'AUTOMOBILE', 'TELEVISIONE', 'COMPUTER', 'BIBLIOTECA',
                    'GIARDINO', 'ELEFANTE', 'CANGURO', 'DINOSAURO'
                ];
                
                this.quartine = [
                    {
                        quando: "La notte di Natale...",
                        dove: "...attorno a un tavolo...", 
                        come: "...con dei fagioli in mano...",
                        perche: "...per fare cinquina!",
                        risposta: "TOMBOLA"
                    },
                    {
                        quando: "Nel 1969...",
                        dove: "...sulla Luna...",
                        come: "...con un piccolo passo...", 
                        perche: "...per l'umanit√†!",
                        risposta: "ALLUNAGGIO"
                    },
                    {
                        quando: "Nel Rinascimento...",
                        dove: "...a Firenze...",
                        come: "...con genio e creativit√†...",
                        perche: "...per dare vita a capolavori!",
                        risposta: "LEONARDO DA VINCI"
                    },
                    {
                        quando: "Ogni quattro anni...",
                        dove: "...in tutto il mondo...",
                        come: "...con atleti e bandiere...",
                        perche: "...per l'onore della propria nazione!",
                        risposta: "OLIMPIADI"
                    }
                ];
                
                this.catene = [
                    {
                        words: ["CHIAVE", "SERRATURA", "PORTA", "CASA", "FAMIGLIA", "TRADIZIONE", "STORIA"],
                        hidden: [1, 2, 3, 4, 5],
                        zip: {
                            words: ["CAPO", "STAZIONE", "CENTRALE", "OPERATIVA"],
                            hidden: [1, 2],
                            answer: "CAPO STAZIONE CENTRALE OPERATIVA",
                            prize: 15000
                        }
                    },
                    {
                        words: ["MONTAGNA", "FUNIVIA", "PANORAMA", "FOTOGRAFIA", "RICORDO", "VIAGGIO", "AVVENTURA"],
                        hidden: [1, 2, 3, 4, 5],
                        zip: {
                            words: ["ONDA", "RADIO", "AMATORE", "SPORTIVO"],
                            hidden: [1, 2],
                            answer: "ONDA RADIO AMATORE SPORTIVO",
                            prize: 20000
                        }
                    }
                ];

                this.updateUI();
            }
            
            setupEventListeners() {
                // Setup squadre
                document.getElementById('addTeamAPlayer').addEventListener('click', () => this.addPlayer('A'));
                document.getElementById('addTeamBPlayer').addEventListener('click', () => this.addPlayer('B'));
                document.getElementById('onlineModeBtn').addEventListener('click', () => this.startOnlineMode());
                
                // Online
                document.getElementById('startOnlineGameBtn').addEventListener('click', () => this.startOnlineGame());
                document.getElementById('backToSetupBtn').addEventListener('click', () => this.showScreen('setupScreen'));
                document.getElementById('connectToGameBtn').addEventListener('click', () => this.connectAsPlayer());
                document.getElementById('buzzerBtn').addEventListener('click', () => this.handleBuzzerPress());
                
                // Gioco 1
                document.getElementById('startGame1Btn').addEventListener('click', () => this.startGame1());
                document.getElementById('buzzerGame1Btn').addEventListener('click', () => this.handleGameBuzzer(1));
                document.getElementById('nextWordBtn').addEventListener('click', () => this.nextWord());
                document.getElementById('correctAnswer1Btn').addEventListener('click', () => this.handleAnswer(true, 1));
                document.getElementById('wrongAnswer1Btn').addEventListener('click', () => this.handleAnswer(false, 1));
                
                // Gioco 2
                document.getElementById('startGame2Btn').addEventListener('click', () => this.startGame2());
                document.getElementById('nextClueBtn').addEventListener('click', () => this.nextClue());
                document.getElementById('nextQuartinaBtn').addEventListener('click', () => this.nextQuartina());
                document.getElementById('correctAnswer2Btn').addEventListener('click', () => this.handleAnswer(true, 2));
                document.getElementById('wrongAnswer2Btn').addEventListener('click', () => this.handleAnswer(false, 2));
                
                // Gioco 3
                document.getElementById('topDirectionBtn').addEventListener('click', () => this.selectDirection('top'));
                document.getElementById('bottomDirectionBtn').addEventListener('click', () => this.selectDirection('bottom'));
                document.getElementById('startGame3Btn').addEventListener('click', () => this.startGame3());
                document.getElementById('buzzerGame3Btn').addEventListener('click', () => this.handleGameBuzzer(3));
                document.getElementById('nextChainBtn').addEventListener('click', () => this.nextChain());
                document.getElementById('correctAnswer3Btn').addEventListener('click', () => this.handleAnswer(true, 3));
                document.getElementById('wrongAnswer3Btn').addEventListener('click', () => this.handleAnswer(false, 3));
                document.getElementById('continueDirectionBtn').addEventListener('click', () => this.continueDirection());
                document.getElementById('changeDirectionBtn').addEventListener('click', () => this.changeDirection());
                
                // ZIP Game
                document.getElementById('playZipBtn').addEventListener('click', () => this.playZip());
                document.getElementById('passZipBtn').addEventListener('click', () => this.passZip());
                document.getElementById('zipCorrectBtn').addEventListener('click', () => this.handleZipAnswer(true));
                document.getElementById('zipWrongBtn').addEventListener('click', () => this.handleZipAnswer(false));
                
                // Input con Enter
                document.getElementById('teamAPlayerInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addPlayer('A');
                });
                document.getElementById('teamBPlayerInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addPlayer('B');
                });
                document.getElementById('connectionCodeInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.connectAsPlayer();
                });
            }
            
            // üë• GESTIONE SQUADRE
            addPlayer(team) {
                const input = document.getElementById(`team${team}PlayerInput`);
                const name = input.value.trim();
                
                if (name && this.gameState[`team${team}`].players.length < 6) {
                    this.gameState[`team${team}`].players.push(name);
                    input.value = '';
                    this.updatePlayersList(team);
                }
            }
            
            removePlayer(team, index) {
                this.gameState[`team${team}`].players.splice(index, 1);
                this.updatePlayersList(team);
            }
            
            updatePlayersList(team) {
                const list = document.getElementById(`team${team}PlayerList`);
                const players = this.gameState[`team${team}`].players;
                
                list.innerHTML = '';
                players.forEach((player, index) => {
                    const item = document.createElement('div');
                    item.className = 'player-item';
                    item.innerHTML = `
                        <span>${player}</span>
                        <button class="btn btn-danger btn-small" onclick="game.removePlayer('${team}', ${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    list.appendChild(item);
                });
            }
            
            // üåê MODALIT√Ä ONLINE
            startOnlineMode() {
                if (this.gameState.teamA.players.length === 0 && this.gameState.teamB.players.length === 0) {
                    alert('Aggiungi almeno un giocatore per squadra!');
                    return;
                }
                
                this.gameState.onlineMode = true;
                this.gameState.connectionCode = this.generateCode();
                
                document.getElementById('connectionCode').textContent = this.gameState.connectionCode;
                document.getElementById('qrCodeText').textContent = this.gameState.connectionCode;
                this.showScreen('onlineScreen');
                this.updateOnlineUI();
            }
            
            connectAsPlayer() {
                const code = document.getElementById('connectionCodeInput').value.trim().toUpperCase();
                
                if (code !== this.gameState.connectionCode) {
                    alert('Codice non valido! Controlla il codice e riprova.');
                    return;
                }
                
                // Simula connessione
                const deviceId = 'device_' + Date.now();
                this.gameState.connectedDevices.set(deviceId, {
                    id: deviceId,
                    connected: true,
                    playerName: '',
                    team: ''
                });
                
                document.getElementById('connectionForm').classList.add('hidden');
                this.showPlayerSelection();
                this.updateOnlineUI();
            }
            
            showPlayerSelection() {
                const container = document.getElementById('playerOptions');
                container.innerHTML = '<h3>üë§ SELEZIONA IL TUO NOME</h3>';
                container.classList.remove('hidden');
                
                // Squadra A
                this.gameState.teamA.players.forEach(player => {
                    const option = document.createElement('div');
                    option.className = 'player-option';
                    option.textContent = `${player} (Squadra A)`;
                    option.onclick = () => this.selectPlayer(player, 'A');
                    container.appendChild(option);
                });
                
                // Squadra B
                this.gameState.teamB.players.forEach(player => {
                    const option = document.createElement('div');
                    option.className = 'player-option';
                    option.textContent = `${player} (Squadra B)`;
                    option.onclick = () => this.selectPlayer(player, 'B');
                    container.appendChild(option);
                });
            }
            
            selectPlayer(playerName, team) {
                // Trova dispositivo non assegnato
                for (let [deviceId, device] of this.gameState.connectedDevices) {
                    if (!device.playerName) {
                        device.playerName = playerName;
                        device.team = team;
                        break;
                    }
                }
                
                document.getElementById('playerOptions').classList.add('hidden');
                document.getElementById('waitingScreen').classList.remove('hidden');
                document.getElementById('playerInfoDisplay').textContent = `Sei: ${playerName} (Squadra ${team})`;
                
                // Mostra buzzer
                document.getElementById('buzzerBtn').classList.remove('hidden');
                
                this.updateOnlineUI();
            }
            
            handleBuzzerPress() {
                if (!this.gameState.onlineMode) return;
                
                // Trova il primo dispositivo connesso (per demo)
                const device = Array.from(this.gameState.connectedDevices.values())[0];
                if (device && device.playerName) {
                    this.showPlayerAnswer(device.playerName);
                    
                    // Disabilita buzzer temporaneamente
                    document.getElementById('buzzerBtn').disabled = true;
                    setTimeout(() => {
                        document.getElementById('buzzerBtn').disabled = false;
                    }, 3000);
                }
            }
            
            showPlayerAnswer(playerName) {
                const display = document.getElementById('playerAnswerDisplay');
                display.textContent = `üéØ ${playerName} HA PREMUTO IL BUZZER!`;
                display.classList.remove('hidden');
                
                // Mostra controlli risposta nel gioco corrente
                const currentGame = this.gameState.currentGame;
                document.getElementById(`answerControls${currentGame}`).classList.remove('hidden');
                document.getElementById(`buzzerGame${currentGame}Btn`).disabled = true;
                
                setTimeout(() => {
                    display.classList.add('hidden');
                }, 3000);
            }
            
            startOnlineGame() {
                if (this.gameState.connectedDevices.size === 0) {
                    alert('Nessun giocatore connesso!');
                    return;
                }
                
                // Inizia primo gioco
                this.startGame1();
            }
            
            // üéØ GIOCO 1: CACCIA ALLA PAROLA
            startGame1() {
                this.showScreen('game1Screen');
                this.gameState.currentGame = 1;
                this.resetGame1();
                this.updateGame1UI();
            }
            
            resetGame1() {
                this.gameState.game1.currentWord = this.words[this.gameState.game1.currentRound - 1];
                this.gameState.game1.revealedLetters = [];
                this.gameState.game1.gameStarted = false;
                
                document.getElementById('game1Message').textContent = 'Pronto a iniziare? Clicca "INIZIA"!';
                document.getElementById('buzzerGame1Btn').disabled = true;
                document.getElementById('nextWordBtn').disabled = true;
                document.getElementById('answerControls1').classList.add('hidden');
                
                this.createWordGrid();
            }
            
            createWordGrid() {
                const grid = document.getElementById('wordGrid');
                grid.innerHTML = '';
                const word = this.gameState.game1.currentWord;
                
                for (let i = 0; i < word.length; i++) {
                    const letterBox = document.createElement('div');
                    letterBox.className = 'letter-box';
                    letterBox.id = `letter-${i}`;
                    grid.appendChild(letterBox);
                }
            }
            
            startRevealingLetters() {
                if (this.gameState.game1.gameStarted) return;
                
                this.gameState.game1.gameStarted = true;
                document.getElementById('startGame1Btn').disabled = true;
                document.getElementById('buzzerGame1Btn').disabled = false;
                
                const word = this.gameState.game1.currentWord;
                const positions = Array.from({length: word.length}, (_, i) => i);
                this.shuffleArray(positions);
                
                let currentIndex = 0;
                const interval = setInterval(() => {
                    if (currentIndex >= word.length) {
                        clearInterval(interval);
                        return;
                    }
                    
                    const pos = positions[currentIndex];
                    this.revealLetter(pos);
                    currentIndex++;
                }, 1500);
            }
            
            revealLetter(position) {
                const letterBox = document.getElementById(`letter-${position}`);
                const word = this.gameState.game1.currentWord;
                
                letterBox.textContent = word[position];
                letterBox.classList.add('revealed');
                this.gameState.game1.revealedLetters.push(word[position]);
            }
            
            handleGame1Buzzer() {
                if (!this.gameState.game1.gameStarted) return;
                
                document.getElementById('game1Message').textContent = 
                    `${this.gameState[`team${this.gameState.currentTeam}`].name}, qual √® la parola?`;
                document.getElementById('buzzerGame1Btn').disabled = true;
                
                if (this.gameState.onlineMode) {
                    this.handleBuzzerPress();
                } else {
                    document.getElementById('answerControls1').classList.remove('hidden');
                }
            }
            
            // üéØ GIOCO 2: QUANDO, DOVE, COME, PERCH√â
            startGame2() {
                this.showScreen('game2Screen');
                this.gameState.currentGame = 2;
                this.resetGame2();
                this.updateGame2UI();
            }
            
            resetGame2() {
                this.gameState.game2.currentStep = 0;
                this.gameState.game2.points = 8000;
                this.gameState.game2.gameStarted = false;
                
                document.getElementById('game2Message').textContent = 'Premi "INIZIA QUARTINA" per cominciare!';
                document.getElementById('nextClueBtn').disabled = true;
                document.getElementById('nextQuartinaBtn').disabled = true;
                document.getElementById('answerControls2').classList.add('hidden');
                
                this.resetQuartinaDisplay();
                this.updateQuartinaPoints();
            }
            
            resetQuartinaDisplay() {
                document.getElementById('quandoLine').classList.remove('revealed');
                document.getElementById('doveLine').classList.remove('revealed');
                document.getElementById('comeLine').classList.remove('revealed');
                document.getElementById('percheLine').classList.remove('revealed');
                
                document.getElementById('quandoText').textContent = '(Quando...)';
                document.getElementById('doveText').textContent = '(Dove...)';
                document.getElementById('comeText').textContent = '(Come...)';
                document.getElementById('percheText').textContent = '(Perch√©...)';
            }
            
            startQuartina() {
                this.gameState.game2.gameStarted = true;
                document.getElementById('startGame2Btn').disabled = true;
                document.getElementById('nextClueBtn').disabled = false;
                
                this.revealQuartinaStep();
            }
            
            revealQuartinaStep() {
                const quartina = this.quartine[this.gameState.game2.currentRound - 1];
                
                if (this.gameState.game2.currentStep >= 0) {
                    document.getElementById('quandoLine').classList.add('revealed');
                    document.getElementById('quandoText').textContent = quartina.quando;
                }
                
                if (this.gameState.game2.currentStep >= 1) {
                    document.getElementById('doveLine').classList.add('revealed');
                    document.getElementById('doveText').textContent = quartina.dove;
                }
                
                if (this.gameState.game2.currentStep >= 2) {
                    document.getElementById('comeLine').classList.add('revealed');
                    document.getElementById('comeText').textContent = quartina.come;
                }
                
                if (this.gameState.game2.currentStep >= 3) {
                    document.getElementById('percheLine').classList.add('revealed');
                    document.getElementById('percheText').textContent = quartina.perche;
                    document.getElementById('nextClueBtn').disabled = true;
                    document.getElementById('nextQuartinaBtn').disabled = false;
                }
            }
            
            nextClue() {
                this.gameState.game2.currentStep++;
                this.gameState.game2.points = 8000 - (this.gameState.game2.currentStep * 2000);
                this.revealQuartinaStep();
                this.updateQuartinaPoints();
            }
            
            updateQuartinaPoints() {
                document.getElementById('pointsValue').textContent = `‚Ç¨${this.gameState.game2.points.toLocaleString()}`;
            }
            
            // üéØ GIOCO 3: UNA TIRA L'ALTRA
            selectDirection(direction) {
                this.gameState.game3.currentDirection = direction;
                
                document.getElementById('topDirectionBtn').classList.toggle('active', direction === 'top');
                document.getElementById('bottomDirectionBtn').classList.toggle('active', direction === 'bottom');
                document.getElementById('startGame3Btn').disabled = false;
                
                document.getElementById('game3Message').textContent = 
                    `Direzione selezionata: ${direction === 'top' ? "dall'alto" : "dal basso"}`;
            }
            
            startGame3() {
                this.gameState.currentGame = 3;
                this.gameState.game3.gameStarted = true;
                
                document.getElementById('directionControls').classList.add('hidden');
                document.getElementById('startGame3Btn').disabled = true;
                document.getElementById('buzzerGame3Btn').disabled = false;
                
                this.createChainDisplay();
                this.startChainTimer();
            }
            
            createChainDisplay() {
                const container = document.getElementById('chainContainer');
                container.innerHTML = '';
                const chain = this.catene[this.gameState.game3.currentRound - 1];
                
                chain.words.forEach((word, index) => {
                    const wordElement = document.createElement('div');
                    wordElement.className = 'chain-word';
                    wordElement.id = `chain-word-${index}`;
                    
                    if (index === 0 || index === chain.words.length - 1) {
                        wordElement.textContent = word;
                        wordElement.classList.add('revealed');
                    } else if (chain.hidden.includes(index)) {
                        wordElement.textContent = '?';
                        wordElement.classList.add('hidden');
                    } else {
                        wordElement.textContent = word;
                        wordElement.classList.add('revealed');
                    }
                    
                    container.appendChild(wordElement);
                });
                
                // Imposta prima parola nascosta in base alla direzione
                if (this.gameState.game3.currentDirection === 'top') {
                    this.gameState.game3.currentWordIndex = 1;
                } else {
                    this.gameState.game3.currentWordIndex = chain.words.length - 2;
                }
                
                this.highlightCurrentWord();
            }
            
            highlightCurrentWord() {
                document.querySelectorAll('.chain-word').forEach(word => {
                    word.classList.remove('current');
                });
                
                const currentWord = document.getElementById(`chain-word-${this.gameState.game3.currentWordIndex}`);
                if (currentWord) {
                    currentWord.classList.add('current');
                }
            }
            
            startChainTimer() {
                this.gameState.game3.timeLeft = 20;
                document.getElementById('chainTimer').classList.remove('hidden');
                document.getElementById('timerValue').textContent = this.gameState.game3.timeLeft;
                
                this.gameState.game3.timer = setInterval(() => {
                    this.gameState.game3.timeLeft--;
                    document.getElementById('timerValue').textContent = this.gameState.game3.timeLeft;
                    
                    if (this.gameState.game3.timeLeft <= 0) {
                        this.handleTimeExpired();
                    }
                }, 1000);
            }
            
            handleTimeExpired() {
                clearInterval(this.gameState.game3.timer);
                document.getElementById('chainTimer').classList.add('hidden');
                
                // Rivelare lettera aggiuntiva e passare all'altra squadra
                this.gameState.currentTeam = this.gameState.currentTeam === 'A' ? 'B' : 'A';
                this.updateAllScores();
                
                document.getElementById('game3Message').textContent = 
                    `Tempo scaduto! Passa a ${this.gameState[`team${this.gameState.currentTeam}`].name}`;
                
                this.startChainTimer();
            }
            
            // üéØ ZIP GAME
            playZip() {
                document.getElementById('zipContainer').classList.remove('hidden');
                document.getElementById('playZipBtn').disabled = true;
                document.getElementById('passZipBtn').disabled = true;
                
                // Mostra prima lettera delle parole nascoste
                const chain = this.catene[this.gameState.game3.currentRound - 1];
                document.getElementById('zipWord2').textContent = chain.zip.words[1].charAt(0);
                document.getElementById('zipWord3').textContent = chain.zip.words[2].charAt(0);
                
                document.getElementById('zipMessage').textContent = 
                    `${this.gameState[`team${this.gameState.currentTeam}`].name}, indovina le parole mancanti!`;
                
                document.getElementById('zipAnswerControls').classList.remove('hidden');
            }
            
            passZip() {
                this.gameState.currentTeam = this.gameState.currentTeam === 'A' ? 'B' : 'A';
                this.updateAllScores();
                this.nextChain();
            }
            
            handleZipAnswer(correct) {
                const chain = this.catene[this.gameState.game3.currentRound - 1];
                
                if (correct) {
                    const points = chain.zip.prize;
                    this.gameState[`team${this.gameState.currentTeam}`].score += points;
                    document.getElementById('zipMessage').textContent = 
                        `Esatto! +‚Ç¨${points.toLocaleString()} per ${this.gameState[`team${this.gameState.currentTeam}`].name}`;
                    
                    // Mostra parole complete
                    document.getElementById('zipWord2').textContent = chain.zip.words[1];
                    document.getElementById('zipWord3').textContent = chain.zip.words[2];
                    document.getElementById('zipWord2').classList.remove('hidden');
                    document.getElementById('zipWord3').classList.remove('hidden');
                    document.getElementById('zipWord2').classList.add('revealed');
                    document.getElementById('zipWord3').classList.add('revealed');
                } else {
                    const otherTeam = this.gameState.currentTeam === 'A' ? 'B' : 'A';
                    this.gameState[`team${otherTeam}`].score += chain.zip.prize;
                    document.getElementById('zipMessage').textContent = 
                        `Risposta errata! +‚Ç¨${chain.zip.prize.toLocaleString()} per ${this.gameState[`team${otherTeam}`].name}`;
                }
                
                document.getElementById('zipAnswerControls').classList.add('hidden');
                
                setTimeout(() => {
                    this.nextChain();
                }, 3000);
            }
            
            // üéÆ FUNZIONI COMUNI
            handleGameBuzzer(gameNumber) {
                if (this.gameState.onlineMode) {
                    this.handleBuzzerPress();
                } else {
                    this.showAnswerControls(gameNumber);
                }
            }
            
            showAnswerControls(gameNumber) {
                document.getElementById(`answerControls${gameNumber}`).classList.remove('hidden');
                document.getElementById(`buzzerGame${gameNumber}Btn`).disabled = true;
            }
            
            handleAnswer(correct, gameNumber) {
                let points = 0;
                
                switch(gameNumber) {
                    case 1:
                        points = 2000;
                        break;
                    case 2:
                        points = this.gameState.game2.points;
                        break;
                    case 3:
                        points = 3000;
                        break;
                }
                
                if (correct) {
                    this.gameState[`team${this.gameState.currentTeam}`].score += points;
                    
                    if (gameNumber === 1) {
                        document.getElementById('nextWordBtn').disabled = false;
                    } else if (gameNumber === 2) {
                        document.getElementById('nextQuartinaBtn').disabled = false;
                    } else if (gameNumber === 3) {
                        // Mostra opzioni direzione per catena
                        document.getElementById('directionOptions').classList.remove('hidden');
                    }
                    
                    document.getElementById(`game${gameNumber}Message`).textContent = 
                        `Esatto! +‚Ç¨${points.toLocaleString()} per ${this.gameState[`team${this.gameState.currentTeam}`].name}`;
                } else {
                    this.gameState.currentTeam = this.gameState.currentTeam === 'A' ? 'B' : 'A';
                    document.getElementById(`game${gameNumber}Message`).textContent = 
                        `Risposta errata! Passa a ${this.gameState[`team${this.gameState.currentTeam}`].name}`;
                }
                
                this.updateAllScores();
                this.hideAnswerControls();
            }
            
            hideAnswerControls() {
                for (let i = 1; i <= 3; i++) {
                    document.getElementById(`answerControls${i}`).classList.add('hidden');
                }
            }
            
            nextWord() {
                this.gameState.game1.currentRound++;
                if (this.gameState.game1.currentRound > this.gameState.game1.totalRounds) {
                    this.startGame2();
                } else {
                    this.startGame1();
                }
            }
            
            nextQuartina() {
                this.gameState.game2.currentRound++;
                if (this.gameState.game2.currentRound > this.gameState.game2.totalRounds) {
                    this.startGame3();
                } else {
                    this.startGame2();
                }
            }
            
            nextChain() {
                this.gameState.game3.currentRound++;
                if (this.gameState.game3.currentRound > this.gameState.game3.totalRounds) {
                    alert('Complimenti! Hai completato tutti i giochi!');
                    this.showScreen('setupScreen');
                } else {
                    this.startGame3();
                }
            }
            
            continueDirection() {
                // Continua nella stessa direzione
                document.getElementById('directionOptions').classList.add('hidden');
                document.getElementById('buzzerGame3Btn').disabled = false;
                this.startChainTimer();
            }
            
            changeDirection() {
                // Cambia direzione
                this.gameState.game3.currentDirection = 
                    this.gameState.game3.currentDirection === 'top' ? 'bottom' : 'top';
                document.getElementById('directionOptions').classList.add('hidden');
                document.getElementById('buzzerGame3Btn').disabled = false;
                this.startChainTimer();
            }
            
            // üéØ UTILITIES
            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            generateCode() {
                return Math.random().toString(36).substring(2, 6).toUpperCase();
            }
            
            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.add('hidden');
                });
                document.getElementById(screenId).classList.remove('hidden');
            }
            
            updateUI() {
                this.updatePlayersList('A');
                this.updatePlayersList('B');
                this.updateOnlineUI();
            }
            
            updateOnlineUI() {
                const devicesGrid = document.getElementById('devicesGrid');
                devicesGrid.innerHTML = '';
                
                if (this.gameState.connectedDevices.size === 0) {
                    devicesGrid.innerHTML = '<p>Nessun dispositivo connesso...</p>';
                    document.getElementById('startOnlineGameBtn').disabled = true;
                    return;
                }
                
                this.gameState.connectedDevices.forEach(device => {
                    const card = document.createElement('div');
                    card.className = `device-card ${device.connected ? 'connected' : ''}`;
                    card.innerHTML = `
                        <div class="device-name">${device.playerName || 'Nuovo dispositivo'}</div>
                        <div class="device-status">${device.playerName ? `${device.playerName} (Squadra ${device.team})` : 'In attesa...'}</div>
                    `;
                    devicesGrid.appendChild(card);
                });
                
                document.getElementById('startOnlineGameBtn').disabled = false;
            }
            
            updateGame1UI() {
                document.getElementById('teamAScore1').textContent = `‚Ç¨${this.gameState.teamA.score}`;
                document.getElementById('teamBScore1').textContent = `‚Ç¨${this.gameState.teamB.score}`;
                document.getElementById('game1RoundInfo').textContent = 
                    `Parola ${this.gameState.game1.currentRound}/${this.gameState.game1.totalRounds}`;
                
                document.getElementById('teamAPanel1').classList.toggle('active', this.gameState.currentTeam === 'A');
                document.getElementById('teamBPanel1').classList.toggle('active', this.gameState.currentTeam === 'B');
            }
            
            updateGame2UI() {
                document.getElementById('teamAScore2').textContent = `‚Ç¨${this.gameState.teamA.score}`;
                document.getElementById('teamBScore2').textContent = `‚Ç¨${this.gameState.teamB.score}`;
                document.getElementById('game2RoundInfo').textContent = 
                    `Quartina ${this.gameState.game2.currentRound}/${this.gameState.game2.totalRounds}`;
                
                document.getElementById('teamAPanel2').classList.toggle('active', this.gameState.currentTeam === 'A');
                document.getElementById('teamBPanel2').classList.toggle('active', this.gameState.currentTeam === 'B');
            }
            
            updateGame3UI() {
                document.getElementById('teamAScore3').textContent = `‚Ç¨${this.gameState.teamA.score}`;
                document.getElementById('teamBScore3').textContent = `‚Ç¨${this.gameState.teamB.score}`;
                document.getElementById('game3RoundInfo').textContent = 
                    `Catena ${this.gameState.game3.currentRound}/${this.gameState.game3.totalRounds}`;
                
                document.getElementById('teamAPanel3').classList.toggle('active', this.gameState.currentTeam === 'A');
                document.getElementById('teamBPanel3').classList.toggle('active', this.gameState.currentTeam === 'B');
            }
            
            updateAllScores() {
                for (let i = 1; i <= 3; i++) {
                    document.getElementById(`teamAScore${i}`).textContent = `‚Ç¨${this.gameState.teamA.score}`;
                    document.getElementById(`teamBScore${i}`).textContent = `‚Ç¨${this.gameState.teamB.score}`;
                    
                    document.getElementById(`teamAPanel${i}`).classList.toggle('active', this.gameState.currentTeam === 'A');
                    document.getElementById(`teamBPanel${i}`).classList.toggle('active', this.gameState.currentTeam === 'B');
                }
            }
        }

        // üöÄ AVVIA IL GIOCO
        const game = new LaureataACatena();
        
        // Aggiungi giocatori di esempio per test
        window.addEventListener('load', () => {
            game.gameState.teamA.players = ['Marco', 'Giulia', 'Luca'];
            game.gameState.teamB.players = ['Anna', 'Paolo', 'Sofia'];
            game.updateUI();
        });

        // Funzioni globali per i button
        window.game = game;
    </script>
</body>
</html>
